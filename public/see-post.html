<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Preview</title>
    <!--<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="index-styles.css">
    <link rel="stylesheet" href="see-post.css">
    <link rel="stylesheet" href="prism.css">
    <link rel="stylesheet" href="toast.css">
    <link rel="stylesheet" href="spinner.css">
    <link rel="icon" type="image/x-icon" href="/Images/favicon.png">
    <style>
.share-section{
    margin-left: 15px;
}

#copy-link-container {
    margin-top: 10px;
    display: flex;
    align-items: center;
}

#post-link {
    width: 80%;
    padding: 5px;
    margin-right: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
}

#copy-link-button {
    padding: 5px 10px;
    cursor: pointer;
    background-color: #007BFF;
    color: white;
    border: none;
    border-radius: 4px;
}
.option-list{
  position : relative;
  width: 100px;
  background-color: #00abe4;
}

    </style>
</head>
<body>
    <div class="pre-header">
        <p>This website is under-development. Please support us with you precious <a href="">DONATIONS</a></p>
    </div>
    <header>
      <a href="index.html"><img src="Images/sadevs-logo.png" alt="company-logo"></a>
      <div class="menu-btn">
          <i id="hamburger" class="fas fa-bars"></i>
      </div>
      <ul class="menu">
          <li><a href="index.html">Home</a></li>
          <li><a href="writeearn.html">Write & Earn</a></li>
          <li><a href="contact.html">Contact</a></li>
          <li><a href="about.html">About</a></li>
          <li id="login-btn" style="margin-left: auto;"><a href="signin.html">Sign In</a></li>
          <li id="signup-btn"><a href="signup.html">Sign Up</a></li>
          <li style="margin-left: auto; background-color: #00abe4; color:#E9F1FA" id="user-profile" style="display:none;">
            <a href="#" id="user-icon"><i class="fa-solid fa-user"></i></a>
            <ul id="user-dropdown" style="display:none;">
              <li><a href="post-article.html">Post an article</a></li>
              <li><a href="profile.html">Your Profile</a></li>
              <li><a href="edit-profile.html">Edit Profile</a></li>
              <li><a href="change-password.html">Change Password</a></li>
              <li><a href="payment-methods.html">Payment Methods</a></li>
              <li><a href="#" id="logout">Logout</a></li>
            </ul>
          </li>
      </ul>
  </header>

    <div class="post-container">
      <div id="loading">
        <div class="spinner"></div>
    </div>
        <!-- Post Title -->
        <h1 class="post-title">Post Title Here</h1>
        
        <!-- Author and Date -->
        <div class="post-meta">
            <span class="post-author">Author Name</span> |
            <span class="post-date">August 27, 2024</span>
        </div>
        
        <!-- Post Content -->
        <div class="post-content">
            <span class="content"></span>
        </div>
        
        <!-- Post Interaction -->
        <div class="post-interaction">
            <span id="like" class="interaction-item" id="like"><i class="fa-solid fa-thumbs-up"></i> </span>
            <span id="likes" class="interaction-item"></span>
            <span style="display: none;" class="interaction-item"><i class="fa-solid fa-comment"></i> 50</span>
            <span class="interaction-item" style="margin-left: 10px;"><i class="fa-solid fa-eye"></i></span>

            <span id="views" class="interaction-item"></span>

            <div class="share-section">
                <span id="share-button"><i class="fa-solid fa-share"></i> Share</span>
                <div id="copy-link-container" style="display: none;">
                    <input type="text" id="post-link" readonly>
                    <button id="copy-link-button">Copy Link</button>
                </div>
            </div>
            <div class="container">
              <span id="option" style="margin-left: 10px; position: relative;" class="interaction-item">
                  <i class="fa-solid fa-ellipsis-vertical"></i>
              </span>
              
              <!-- Main menu -->
              <ul id="menu" style="display: none;">
                <li id="menu-item-2">Report<pre style="display: inline">           v</pre></li>
              </ul>
              
              <!-- Submenu (initially hidden) -->
              <ul id="submenu" style="display: none;">
                <li onclick="toast('Spam')" >Spam: Irrelevant, Promotional, Repetitive</li>
                <li onclick="toast('Hate Speech')" >Hate Speech: Voilent, Discriminative, Racism, Gender-based</li>
                <li onclick="toast('Plagiarism')" >Plagiarism: Copied from another sourse without credit.</li>
                <li onclick="toast('Misinfo')" >Misinformation: False or misleading information</li>
                <li onclick="toast('Inapp Lang')" >Inappropriate Language: Includes offensive or vulgar language</li>
                <li onclick="toast('Sexual')" >Sexually explicit content</li>
                <li onclick="toast('Personal Info')" >Personal Information: Sensitive or private information</li>
              </ul>
              <!-- The actual snackbar -->
              <div id="snackbar" style="display: none;">Some text some message..</div>
            </div>
            

          </ul>
      
        </div>
    </div>



          
    <div class="footer">
        <div class="col col1">
            <p>CONTENT</p>
            <a href="">IT & Tech</a>
            <a href="">News</a>
            <a href="">Write & Earn</a>
            <a href="">How to use?</a>
            <a href="">FAQs</a>
        </div>
        <div class="col col2">
            <p>SERVICES</p>
            <a href="">Free Articles Publishing</a>
            <a href="">Website Development</a>
            <a href="">Mobile App Development</a>
            <a href="">Video Editing</a>
            <a href="">Online Courses</a>
            <a href="">Graphic Designing</a>
            <a href="">Get a Tutor</a>
            <a href="">Counseling</a>
        </div>
        <div class="col col3">
            <p>CONTACTS</p>
            <a href="">Address: Chitral Town, Lower Chitral</a>
            <a href="">KPK, Pakistan</a>
            <a href="">Contact No. +92375857692</a>
            <a href="">Contact Us</a>
            <a href="">Privacy Policy</a>
            <a href="">Site Developer</a>
            <a href="">About Us</a>
        </div>
        <div class="col col4">
            <p>SOCIAL LINKS</p>
            <a href=""><i class="fa-brands fa-facebook"><span> Facebook</span></i></a>
            <a href=""><i class="fa-brands fa-youtube"><span> YouTube</span></i></a>
            <a href=""><i class="fa-brands fa-whatsapp"><span> Whatsapp</span></i></a>
            <a href=""><i class="fa-brands fa-instagram"><span> Instagram</span></i></a>
            <a href=""><i class="fa-brands fa-x-twitter"><span> X-Twitter</span></i></a>
            <a href=""><i class="fa-solid fa-envelope"><span> GMail</span></i></a>
            <a href=""><i class="fa-brands fa-github"><span> GitHub</span></i></a>
        </div>
    </div>
    <div class="footer2">
        <span>Copyright Â© 2024 - onwards SADEVs Company. All rights reserved.</span>
    </div>

</body>


<script src="log.js"></script>
<script src="prism.js"></script>
<script>
const urlParams = new URLSearchParams(window.location.search);
const title = urlParams.get('title');
const postId = urlParams.get('id');
const postUrl = `${window.location.origin}/view-post.html?title=${title}`;
loadViews(postId);
loadLikes(postId);
document.addEventListener('DOMContentLoaded', function() {
    // Send the postId as a query parameter in the fetch request

    const shareButton = document.getElementById('share-button');
    const copyLinkContainer = document.getElementById('copy-link-container');
    const postLinkInput = document.getElementById('post-link');
    const copyLinkButton = document.getElementById('copy-link-button');
    shareButton.addEventListener('click', function() {
        // Show the copy link container and set the post link
        copyLinkContainer.style.display = 'flex';
        postLinkInput.value = postUrl;
    });

    copyLinkButton.addEventListener('click', function() {
        // Copy the post link to the clipboard
        postLinkInput.select();
        document.execCommand('copy');
        alert('Link copied to clipboard!');
    });

    
    // Show the loading element
    document.getElementById('loading').style.display = 'block';
    fetch(`/get-post-from-db?id=${postId}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to load post data');
            }
            return response.json();
        })
        .then(data => {
          window.globalData = data;
            // Update the page with the post data
            document.querySelector('.post-title').textContent = data.title;
            document.querySelector('.post-author').textContent = data.authorName;
            document.querySelector('.post-date').textContent = new Date(data.createdAt).toLocaleDateString();
            document.querySelector('.content').innerHTML = data.content;
        })
        .catch(error => {
            console.error('Error fetching post data:', error);
        }).finally(()=> {
          document.getElementById('loading').style.display = 'none';
        });



        const like = document.getElementById("like");
        const view = document.getElementById("view");
        const share = document.getElementById("share");


    const menuBtn = document.querySelector('.menu-btn');
    const menu = document.querySelector('.menu');

    menuBtn.addEventListener('click', function() {
        menu.classList.toggle('active');
    });
});

async function loadViews(id){
  const views = document.getElementById("views");
  try{
  const postId = id;
  const response = await fetch(`/get-views?id=${postId}`);
  const data = await response.json();
  views.innerText = data.views;
}
catch(error){
  console.log("Error fetching views", error);
}
}

const likeButton = document.getElementById('like');

  likeButton.addEventListener('click', async () => {
    try {
      const response = await fetch('/like-post', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ postId })
      });

      const result = await response.json();

      if (result.liked) {
        likeButton.style.color = 'hotpink'; // Change color to red when liked
        loadLikes(postId);
      } else {
        likeButton.style.color = ''; // Reset color when unliked
        loadLikes(postId);
      }
    } catch (error) {
      console.error('Error liking post:', error);
    }
  });

  // Initial check to see if the user has already liked the post
  fetch(`/check-like-status?postId=${postId}`)
    .then(response => response.json())
    .then(data => {
      if (data.liked) {
        likeButton.style.color = 'hotpink'; // Set button color to red if already liked
        loadLikes(postId);
      }
    })
    .catch(error => {
      console.error('Error checking like status:', error);
    });

  async function loadLikes(postId){
  const likes = document.getElementById("likes");
  try{
  const response = await fetch(`/get-likes?id=${postId}`);
  const data = await response.json();
  likes.innerText = data.likes;
}
catch(error){
  console.log("Error fetching views", error);
}
}

//Report
const menu = document.getElementById('menu');
const option = document.getElementById('option');
const submenu = document.getElementById('submenu');
const menuItem = document.getElementById('menu-item-2'); // Menu item that opens the submenu

// Toggle menu on kebab icon click
option.addEventListener('click', function (event) {
    menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
    submenu.style.display = 'none'; // Hide the submenu when the main menu is clicked
    event.stopPropagation(); // Prevent click from propagating
});

// Hide menu and submenu on clicking outside of it
document.addEventListener('click', function () {
    menu.style.display = 'none';
    submenu.style.display = 'none';
});

// Prevent hiding when clicking inside the menu
menu.addEventListener('click', function (event) {
    event.stopPropagation();
});

// Toggle submenu when clicking on specific menu item
menuItem.addEventListener('click', function (event) {
    submenu.style.display = submenu.style.display === 'none' ? 'block' : 'none';
    event.stopPropagation(); // Prevent click from propagating
});

async function toast(type) {
  alert(type);
  try {
    const response = await fetch('/submit-report', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        postId,
        postTitle: globalData.title,
        username: globalData.authorName,
        type: type
      }),
    });

    const data = await response.json();
    if (data.success) {
      // Get the snackbar DIV
      var x = document.getElementById("snackbar");

      // Add the "show" class to DIV
      x.innerText = "Thank you! Reported for review";
      x.className = "show";
      x.style.display = "block";

      // After 3 seconds, remove the show class from DIV
      setTimeout(function () {
        x.className = x.className.replace("show", "");
        x.style.display = "none";
      }, 3000);
    } else {
      console.log("Not reported successfully");
      console.log("Error:", data.message);
    }
  } catch (e) {
    console.log("Error reporting:", e);
  }
}

</script>
</html>
