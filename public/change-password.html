<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Change Password </title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="index-styles.css">
    <link rel="stylesheet" href="signup.css">
    <link rel="stylesheet" href="spinner.css">
    <link rel="icon" type="image/x-icon" href="Images/logo pure.png">
    <style>
    </style>
</head>
<body>
    <div class="pre-header">
        <p>This website is under-development. Please support us with you precious <a href="">DONATIONS</a></p>
    </div>
    <header>
        <a href="index.html"><img src="Images/sadevs-logo.png" alt="company-logo"></a>
        <div class="menu-btn">
            <i id="hamburger" class="fas fa-bars"></i>
        </div>
        <ul class="menu">
            <li><a href="index.html">Home</a></li>
            <li><a href="writeearn.html">Write & Earn</a></li>
            <li><a href="contact.html">Contact</a></li>
            <li><a href="about.html">About</a></li>
            <li id="login-btn" style="margin-left: auto;"><a href="signin.html">Sign In</a></li>
            <li id="signup-btn"><a href="signup.html">Sign Up</a></li>
            <li style="margin-left: auto; background-color: #00abe4; color:#E9F1FA" id="user-profile" style="display:none;">
              <a href="#" id="user-icon"><i class="fa-solid fa-user"></i></a>
              <ul id="user-dropdown" style="display:none;">
                <li><a href="post-article.html">Post an article</a></li>
                <li><a href="profile.html">Your Profile</a></li>
                <li><a href="edit-profile.html">Edit Profile</a></li>
                <li><a href="change-password.html">Change Password</a></li>
                <li><a href="payment-methods.html">Payment Methods</a></li>
                <li><a href="#" id="logout">Logout</a></li>
              </ul>
            </li>
        </ul>
    </header>  
  <div class="wrapper" id="wrapper">
    <div id="loading">
      <div class="spinner"></div>
  </div>
        <h2 id="head">Change your password</h2>
        <form id = "change-form">
          <div class="input-box">
            <input type="text" id="old-pass" placeholder="Old Password" required>
          </div>
          <div class="input-box">
            <input type="text" id="new-pass" placeholder="New Password" required>
          </div>
          <div class="input-box">
            <input type="text" id="new-cpass" placeholder="Confirm Password" required>
          </div>
          <div class="input-box button">
            <input type="Submit" id="change-btn" value="Change">
          </div>
        </form>
      </div>

      <script src="log.js"></script>
      <script>
        document.addEventListener('DOMContentLoaded', function() {
            const menuBtn = document.querySelector('.menu-btn');
            const menu = document.querySelector('.menu');
            
            menuBtn.addEventListener('click', function() {
                menu.classList.toggle('active');
            });
        });
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
$("#change-btn").click(async function(event){
  event.preventDefault();
  const oldPass = $("#old-pass").val();
  const newPass = $("#new-pass").val();
  const newCPass = $("#new-cpass").val();

  if (newPass !== newCPass) {
    alert("Passwords do not match");
  } else {
    try {

    // Show the loading element
    document.getElementById('loading').style.display = 'block';
      const response = await fetch('/change-password', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ oldPass, newPass }),
      });

      const result = await response.json();

      if (result.success) {
        alert("Success: " + result.message);
      } else {
        alert("Failure: " + result.message);
      }
    } catch (error) {
      console.error("Error occurred:", error);
      alert("An error occurred while changing the password.");
    }finally {
        // Hide the loading element
        document.getElementById('loading').style.display = 'none';
    }
  }
});

    </script>
</body>
</html>