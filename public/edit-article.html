<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Article</title>
    <!--<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="index-styles.css">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <link rel="stylesheet" href="prism.css">
    <link rel="icon" type="image/x-icon" href="Images/logo pure.png">
    <style>
        .form-post{
            margin-top: 30px;
            display:flex;
            flex-direction: column;
            justify-content: center;
        }
        .btn-submit{margin-top: 10px; 
            border-radius: 10px; 
            width: 100px; 
            border:none;  
            background-color: #00abe4; 
            color:white; 
            font-weight: bold; 
            padding:10px;
            align-self: center;
            font-size: 16px;
        }
        .btn-submit:hover{
            background-color: #1e395b;
            box-sizing: border-box;
        }
        .post-title-input{
            height: 30px;
            width:100%;
            border: 0px solid #000000;
            border-bottom-width: 1px;
            background-color: transparent;
            font-size: 24px;
            padding:10px;
            color:#1e395b
        }
        .post-title-input:focus{
            outline: none;
        }
    </style>
</head>
<body>
    <div class="pre-header">
        <p>This website is under-development. Please support us with you precious <a href="">DONATIONS</a></p>
    </div>
    <header>
        <a href="index.html"><img src="Images/sadevs-logo.png" alt="company-logo"></a>
        <div class="menu-btn">
            <i id="hamburger" class="fas fa-bars"></i>
        </div>
        <ul class="menu">
            <li><a href="index.html">Home</a></li>
            <li><a href="writeearn.html">Write & Earn</a></li>
            <li><a href="contact.html">Contact</a></li>
            <li><a href="about.html">About</a></li>
            <li id="login-btn" style="margin-left: auto;"><a href="signin.html">Sign In</a></li>
            <li id="signup-btn"><a href="signup.html">Sign Up</a></li>
            <li style="margin-left: auto; background-color: #00abe4; color:#E9F1FA" id="user-profile" style="display:none;">
              <a href="#" id="user-icon"><i class="fa-solid fa-user"></i></a>
              <ul id="user-dropdown" style="display:none;">
                <li><a href="post-article.html">Post an article</a></li>
                <li><a href="profile.html">Your Profile</a></li>
                <li><a href="edit-profile.html">Edit Profile</a></li>
                <li><a href="change-password.html">Change Password</a></li>
                <li><a href="payment-methods.html">Payment Methods</a></li>
                <li><a href="#" id="logout">Logout</a></li>
              </ul>
            </li>
        </ul>
    </header>


    <main>
        <h2 style="color:#1e395b; margin-top:20px; text-decoration: underline; margin-bottom: 20px; text-align:center; font-size: 30px;">Edit your article</h2>
        <input type="text" id="post-title" class="post-title-input" placeholder="Enter Title Here" required>
        <form id="post-form" class="form-post">
            <div style="min-height: 300px;" id="editor-container"></div>
            <input type="file" id="upload-image" accept="image/*" multiple style="margin-top:10px;">
            <span style="font-size: 11px;">To insert image, click above</span>
            <br>
            <button id="post-submit-btn" class="btn-submit" type="submit">Update</button>
        </form>
    </main>


    
    <div class="footer">
        <div class="col col1">
            <p>CONTENT</p>
            <a href="">IT & Tech</a>
            <a href="">News</a>
            <a href="">Write & Earn</a>
            <a href="">How to use?</a>
            <a href="">FAQs</a>
        </div>
        <div class="col col2">
            <p>SERVICES</p>
            <a href="">Free Articles Publishing</a>
            <a href="">Website Development</a>
            <a href="">Mobile App Development</a>
            <a href="">Video Editing</a>
            <a href="">Online Courses</a>
            <a href="">Graphic Designing</a>
            <a href="">Get a Tutor</a>
            <a href="">Counseling</a>
        </div>
        <div class="col col3">
            <p>CONTACTS</p>
            <a href="">Address: Chitral Town, Lower Chitral</a>
            <a href="">KPK, Pakistan</a>
            <a href="">Contact No. +92375857692</a>
            <a href="">Contact Us</a>
            <a href="">Privacy Policy</a>
            <a href="">Site Developer</a>
            <a href="">About Us</a>
        </div>
        <div class="col col4">
            <p>SOCIAL LINKS</p>
            <a href=""><i class="fa-brands fa-facebook"><span> Facebook</span></i></a>
            <a href=""><i class="fa-brands fa-youtube"><span> YouTube</span></i></a>
            <a href=""><i class="fa-brands fa-whatsapp"><span> Whatsapp</span></i></a>
            <a href=""><i class="fa-brands fa-instagram"><span> Instagram</span></i></a>
            <a href=""><i class="fa-brands fa-x-twitter"><span> X-Twitter</span></i></a>
            <a href=""><i class="fa-solid fa-envelope"><span> GMail</span></i></a>
            <a href=""><i class="fa-brands fa-github"><span> GitHub</span></i></a>
        </div>
    </div>
    <div class="footer2">
        <span>Copyright Â© 2024 - onwards SADEVs Company. All rights reserved.</span>
    </div>

</body>

<script src="log.js"></script>
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script src="https://cdn.jsdelivr.net/npm/quill-image-resize-module@3.0.0/image-resize.min.js"></script>

<script>
    
    const urlParams = new URLSearchParams(window.location.search);
    const postId = urlParams.get('id');
const quill = new Quill('#editor-container', {
    theme: 'snow',
    placeholder: 'Write your article...',
    modules: {
        toolbar: [
            ['&nbsp','&nbsp','&nbsp','&nbsp'],
            [{ header: [1, 2, 3, 4, 5, false] }],
            [{ 'color': [] }, { 'background': [] }], // dropdown with defaults from theme
            [{ 'font': [] }],
            [{ 'align': [] }],
            ['bold', 'italic', 'underline'],   
            ['code-block'],
            [{ list: 'ordered' }, { list: 'bullet' }],
            [{ 'script': 'sub'}, { 'script': 'super' }],
            ['link', 'blockquote'],
            ['&nbsp','&nbsp','&nbsp','&nbsp']
        ],
        imageResize: {  
            displaySize: true // This allows the user to see the size of the image as they resize it
        }
    }
});

document.getElementById('upload-image').addEventListener('change', async function () {
    const fileInput = this;
    const files = fileInput.files;

    if (files.length > 0) {
        const formData = new FormData();
        formData.append('image', files[0]);
        try {
            const response = await fetch('/upload', {
                method: 'POST',
                body: formData
            });

            const data = await response.json();
            if (data.success) {
                const range = quill.getSelection();
                quill.insertEmbed(range.index, 'image', data.imageUrl);
            } else {
                alert('Image upload failed');
            }
        } catch (error) {
            console.error('Error uploading image:', error);
            alert('An error occurred while uploading the image.');
        }
    }
});

        loadEditingData();
        async function loadEditingData(){
        try{
        const response = await fetch(`/get-post-from-db?id=${postId}`);
        const data = await response.json();
        console.log(data);
        document.getElementById("post-title").value = data.title;
        quill.root.innerHTML = data.content;
        window.views = data.views;
        window.likes = data.likes; 
        window.viewedBy = data.viewedBy;
        window.likedBy = data.likedBy;
        }
        
        catch(error){
            console.error('Error fetching post data:', error);
        }
    }



    document.getElementById('post-form').addEventListener('submit', async function (event) {
        event.preventDefault(); // Prevent the form from submitting the usual way

        const postId = urlParams.get('id');
        const title = document.getElementById('post-title').value;
        const content = quill.root.innerHTML;
        const fileInput = document.getElementById('upload-image');
        const files = fileInput.files;

        const formData = new FormData();
        formData.append('title', title);
        formData.append('content', content);
        formData.append('postId', postId); // Send the post ID

        for (let i = 0; i < files.length; i++) {
            formData.append('images', files[i]);
        }

        try {
            const response = await fetch('/update-post', {
                method: 'PUT',
                body: formData
            });

            const result = await response.json();

            if (result.success) {
                alert('Post updated successfully!');
                window.location.href = '/index.html'; // Redirect after update
            } else {
                alert('Error updating post');
            }
        } catch (error) {
            console.error('Error updating post:', error);
            alert('An error occurred while updating the post.');
        }
    });

</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const menuBtn = document.querySelector('.menu-btn');
        const menu = document.querySelector('.menu');

        menuBtn.addEventListener('click', function() {
            menu.classList.toggle('active');
        });
    });
    </script>
    <script src="prism.js" class="language-JavaScript"></script>

</html>
